{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Codex Code Review Output",
  "description": "Structured output schema for Codex deep code review",
  "type": "object",
  "required": [
    "repository_info",
    "dimensions",
    "findings",
    "overall_assessment"
  ],
  "properties": {
    "repository_info": {
      "type": "object",
      "description": "Repository and change metadata",
      "properties": {
        "repository": {
          "type": "string",
          "description": "Repository name"
        },
        "pull_request": {
          "type": "string",
          "description": "Pull request number or commit SHA"
        },
        "base_ref": {
          "type": "string",
          "description": "Base branch/ref"
        },
        "head_ref": {
          "type": "string",
          "description": "Head branch/ref"
        },
        "changed_files": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of changed files"
        }
      }
    },
    "dimensions": {
      "type": "array",
      "description": "8-dimensional code quality assessment",
      "minItems": 8,
      "maxItems": 8,
      "items": {
        "type": "object",
        "required": ["name", "rating", "score", "summary", "issues"],
        "properties": {
          "name": {
            "type": "string",
            "enum": [
              "Code Style & Formatting",
              "Security & Compliance",
              "Error Handling & Logging",
              "Readability & Maintainability",
              "Performance & Scalability",
              "Testing & Quality Assurance",
              "Documentation & Version Control",
              "Accessibility & Internationalization"
            ],
            "description": "Dimension name"
          },
          "rating": {
            "type": "string",
            "enum": ["extraordinary", "acceptable", "poor"],
            "description": "Overall rating for this dimension"
          },
          "score": {
            "type": "number",
            "minimum": 0,
            "maximum": 100,
            "description": "Numeric score (0-100)"
          },
          "summary": {
            "type": "string",
            "description": "1-2 sentence summary of findings in this dimension (in Chinese)"
          },
          "issues": {
            "type": "array",
            "description": "Specific issues identified in this dimension",
            "items": {
              "type": "string"
            }
          }
        }
      }
    },
    "findings": {
      "type": "array",
      "description": "Detailed findings with file/line citations",
      "items": {
        "type": "object",
        "required": ["title", "body", "confidence_score", "priority", "code_location"],
        "properties": {
          "title": {
            "type": "string",
            "maxLength": 80,
            "description": "Issue title with priority prefix (e.g., '[P0] Critical bug') (in Chinese)"
          },
          "body": {
            "type": "string",
            "description": "Detailed explanation with file/line citations (in Chinese)"
          },
          "confidence_score": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "Confidence score (0.0-1.0)"
          },
          "priority": {
            "type": "integer",
            "minimum": 0,
            "maximum": 3,
            "description": "Priority level (0=P0, 1=P1, 2=P2, 3=P3)"
          },
          "code_location": {
            "type": "object",
            "required": ["absolute_file_path", "line_range"],
            "properties": {
              "absolute_file_path": {
                "type": "string",
                "description": "Absolute file path"
              },
              "line_range": {
                "type": "object",
                "required": ["start", "end"],
                "properties": {
                  "start": {
                    "type": "integer",
                    "minimum": 1,
                    "description": "Start line number"
                  },
                  "end": {
                    "type": "integer",
                    "minimum": 1,
                    "description": "End line number"
                  }
                }
              }
            }
          },
          "suggestion": {
            "type": "string",
            "description": "Fix suggestion (in Chinese)"
          },
          "fixPrompt": {
            "type": "string",
            "description": "Copyable fix prompt for Claude Code/Codex (in Chinese)"
          },
          "dimension": {
            "type": "string",
            "description": "Related dimension name"
          }
        }
      }
    },
    "associationRisks": {
      "type": "array",
      "description": "Potential association risks",
      "items": {
        "type": "object",
        "required": ["changedFile", "relatedFiles", "risk"],
        "properties": {
          "changedFile": {
            "type": "string",
            "description": "The file that was changed"
          },
          "relatedFiles": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Files that might be affected"
          },
          "risk": {
            "type": "string",
            "description": "Risk description (in Chinese)"
          },
          "checkPrompt": {
            "type": "string",
            "description": "Verification prompt (in Chinese)"
          }
        }
      }
    },
    "overall_assessment": {
      "type": "object",
      "required": ["correctness", "explanation", "confidence_score"],
      "properties": {
        "correctness": {
          "type": "string",
          "enum": ["patch is correct", "patch is incorrect"],
          "description": "Overall correctness verdict"
        },
        "explanation": {
          "type": "string",
          "description": "1-3 sentence justification for the verdict (in Chinese)"
        },
        "confidence_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Overall confidence score (0.0-1.0)"
        }
      }
    },
    "summary": {
      "type": "string",
      "description": "Brief summary of the changes (1-2 sentences) (in Chinese)"
    },
    "commitMatch": {
      "type": "boolean",
      "description": "Whether changes match commit description"
    },
    "commitMatchReason": {
      "type": "string",
      "description": "Explanation of commit match assessment (in Chinese)"
    }
  }
}
